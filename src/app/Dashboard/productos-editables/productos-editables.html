<div class="container mt-5">
  <div class="card shadow-lg border-0 rounded-lg">
    <div class="card-header bg-primary text-white">
      <h4 class="mb-0">Editar producto</h4>
    </div>

    <div class="card-body">
      <form #f="ngForm" (ngSubmit)="guardarCambios()">
        <div class="form-group mb-3">
          <label>Título</label>
          <input type="text" name="titulo" class="form-control" [(ngModel)]="producto.titulo" required>
        </div>

        <div class="form-group mb-3">
          <label>Descripción</label>
          <textarea name="descripcion" class="form-control" [(ngModel)]="producto.descripcion"></textarea>
        </div>

        <div class="form-group mb-3">
          <label>Precio</label>
          <input type="number" name="precio" class="form-control" [(ngModel)]="producto.precio" required>
        </div>

                <div class="form-group mb-3">
                    <label for="ano">Año</label>
                    <select id="ano" class="form-control" name="ano"[(ngModel)]="producto.ano" required>
                        <option [ngValue]="''" disabled>-- Selecciona una año --</option>
                        <option *ngFor="let an of ano" [value]="an">{{ an }}</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="tramision">Transmision</label>
                    <select id="tramision" class="form-control" name="tramision"[(ngModel)]="producto.tramision" required>
                        <option [ngValue]="''" disabled>-- Selecciona una transmision --</option>
                        <option *ngFor="let trans of transmisione" [value]="trans">{{ trans }}</option>
                    </select>
                </div>

                <div class="form-group mb-3">
                    <label for="categoria">Categoría</label>
                    <select id="categoria" class="form-control" name="categoria"[(ngModel)]="producto.categoria" required>
                        <option [ngValue]="''" disabled>-- Selecciona una marca --</option>
                        <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
                    </select>
                </div>
  
        <div class="form-group mb-3">
            <label>Imagen Actual</label>
            <div *ngIf="producto.imageUrl" class="mt-2 text-center border p-2 rounded">
                <!-- Muestra la imagen actual o la previsualización del nuevo archivo -->
                <img [src]="getImageUrl(producto.imageUrl)" alt="Imagen actual" class="img-thumbnail" style="max-height: 150px; max-width: 150px; object-fit: cover;">
                <p class="small text-muted mt-1">{{ selectedFile ? 'Nueva imagen seleccionada' : 'Ruta actual: ' + producto.imageUrl }}</p>
            </div>
            <div *ngIf="!producto.imageUrl" class="alert alert-info small mt-2">
                No hay imagen asignada a este producto.
            </div>
            
            <!-- Input para cambiar  imagen -->
            <label for="nuevaImagen" class="mt-3">Cambiar Foto </label>
            <input type="file" id="nuevaImagen" class="form-control" (change)="onFileSelected($event)" accept="image/*">
        </div>
        <div class="d-flex justify-content-between mt-4">
          <button type="submit" class="btn btn-success" [disabled]="isUploading">
            <span *ngIf="isUploading" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            <i *ngIf="!isUploading" class="bi bi-check-circle"></i> 
            {{ isUploading ? 'Subiendo imagen...' : 'Guardar cambios' }}
          </button>

          <button type="button" class="btn btn-danger" (click)="eliminarProducto()" [disabled]="isUploading">
            <i class="bi bi-trash"></i> Eliminar
          </button>

          <button type="button" class="btn btn-secondary" (click)="cancelar()" [disabled]="isUploading">
            <i class="bi bi-arrow-left"></i> Cancelar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>